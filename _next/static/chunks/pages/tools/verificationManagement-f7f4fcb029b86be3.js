(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9075],{2792:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tools/verificationManagement",function(){return l(6024)}])},1201:function(e,t,l){"use strict";l.d(t,{u:function(){return d},z:function(){return s}});var n=l(3342),r=l(8591),i=l.n(r),a=l(4209);function s(e){let{children:t,className:l,...r}=e;return(0,n.jsx)("button",{...r,className:i()(l,"hover:bg-green-28"),children:e.children})}function d(e){let{busy:t,disabled:l,className:r,defStyle:s="btn-primary",children:d,...c}=e;return(0,n.jsx)("button",{className:i()(r,{[s]:!l,"btn-disable":l}),...c,children:t?(0,n.jsx)(a.fCD,{className:"animate-spin"}):d})}},4247:function(e,t,l){"use strict";l.d(t,{Ph:function(){return x},dW:function(){return u},ub:function(){return m}});var n=l(3342),r=l(5361),i=l(8591),a=l.n(i),s=l(9685),d=l(5295),c=l(2239),o=l(367);function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,[l,n]=(0,s.useState)(t);return(0,s.useEffect)(()=>{n(t)},[e,t]),{onChange:n,items:e,current:l}}function x(e){let{items:t,current:l,onChange:i,className:u="bg-white text-black px-5 py-3 text-lg rounded-lg w-[31.25rem] mo:w-full mo:text-sm",currentClassName:x="flex justify-between items-center",openClassName:m="max-h-[18rem] bg-white  rounded-lg py-3 "}=e,f=t[l]?t[l].text:"",[h,v]=(0,c.Z)(!1),p=(0,s.useCallback)(e=>{l!==e&&i(e)},[l]),g=(0,r.E)("t-side");return((0,o.Z)(g,()=>h&&v(!1)),0===t.length)?null:(0,n.jsxs)("div",{ref:g,className:a()("relative cursor-pointer",u),onClick:()=>v(),children:[(0,n.jsxs)("div",{className:x,children:[(0,n.jsx)("span",{className:"truncate",children:f}),h?(0,n.jsx)(d.pzk,{}):(0,n.jsx)(d._i7,{})]}),h&&(0,n.jsx)("div",{className:a()("absolute z-[100] left-0 w-full overflow-x-hidden overflow-y-auto",m),style:{boxShadow:"0px 5px 15px rgba(0, 0, 0, 0.15)",top:"calc(100% + 8px)"},children:(0,n.jsx)("div",{className:"",children:t.map((e,t)=>(0,n.jsx)("div",{style:{},className:a()("w-full break-all px-5 py-2 text-sm hover:bg-gray-16",{"text-green-2":t===l}),onClick:()=>p(t),children:e.text},"select_item_".concat(t)))})})]})}let m=e=>(0,n.jsx)(x,{className:"h-[50px] px-5 items-center bg-stone-50 rounded-lg border border-neutral-200",currentClassName:"h-full flex justify-between items-center",...e})},124:function(e,t,l){"use strict";l.d(t,{m:function(){return v}});var n=l(3342),r=l(107),i=l(8996),a=l(1882),s=l(3958),d=l(8591),c=l.n(d),o=l(2577),u=l(3917),x=l(5390),m=l(1608),f=l(8761);function h(e){let{children:t,className:l,tits:i,showQuery:a,isManager:d,...h}=e,{push:v}=(0,r.useRouter)(),p=(0,f.fo)();return(0,s.dD)(),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:c()("w-full relative z-[3] max-w-[90rem] mx-auto text-white flex items-center top-0 px-[7.5rem] h-[4.25rem] justify-between",l),...h,children:[(0,n.jsxs)("div",{className:"flex items-center cursor-pointer ml-[-1rem] mo:ml-0",onClick:()=>v("/"),children:[(0,n.jsx)(o.Z,{className:"h-[2.275rem] mo:h-[2rem]"}),(0,n.jsx)(u.Z,{className:"h-[1.5rem] mt-2.5 ml-3 mo:h-[1.1rem] mo:mt-3"})]}),(0,n.jsx)(x.R,{menus:p,children:(0,n.jsx)("button",{className:"text-[2rem] mo:text-2xl",children:(0,n.jsx)(m.otZ,{})})})]})})}function v(e){let{className:t,canBack:l,children:s,link:d,isNew:o,containerClassName:u,...x}=e,{push:m}=(0,r.useRouter)(),f=(0,i.R)();return(0,n.jsxs)("div",{className:"relative flex flex-col flex-1 w-full h-full min-h-fit bg-gray-16",children:[(0,n.jsx)(h,{showQuery:!0,style:{top:"".concat(f,"px")},className:"!sticky px-[3.125rem] py-4 !max-w-none bg-green-2 mo:px-4 mo:h-[4.25rem]"}),(0,n.jsxs)("div",{className:c()("w-full h-full mx-auto px-[60px] flex flex-col flex-1",u,{" max-w-[90rem]":!o}),children:[l&&(0,n.jsxs)("div",{className:"flex items-center my-5 text-sm ".concat((null==d?void 0:d.pathName)?"cursor-default":"cursor-pointer"),onClick:()=>(null==d?void 0:d.pathName)?void 0:m("/carbon/service"),children:[!d&&(0,n.jsx)(a.YFh,{className:"text-lg"}),d&&"{}"!==JSON.stringify(d)?(0,n.jsxs)("div",{className:"flex flex-row",children:[(0,n.jsx)("span",{className:"text-[#000000] cursor-pointer font-bold  text-[14px]",onClick:()=>m(null==d?void 0:d.pathName),children:d.homeTitle}),(0,n.jsx)("div",{className:"mx-1 ",children:" / "}),(0,n.jsxs)("span",{className:"cu text-[#999999] font-normal text-[14px]",children:[" ",d.currentTitle]})]}):"返回"]}),(0,n.jsx)("div",{className:c()("flex flex-col ",t),children:s})]})]})}},9749:function(e,t,l){"use strict";l.d(t,{H4:function(){return s},Kv:function(){return a},Tz:function(){return c},We:function(){return d}});var n=l(7207),r=l.n(n),i=l(6631);function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,i.ZP)("/api/product-system/".concat(e,"/detail"),{refreshInterval:t})}function s(e){return(0,i.ZP)(r().isNil(e)?null:"/api/verifyRecord/".concat(e,"/detail"))}function d(e){return(0,i.ZP)(e?"/api/inventory/all":null)}function c(e){return(0,i.ZP)(e?"/api/verifyRecord/verifiers":null)}},6024:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return U}});var n=l(3342),r=l(124),i=l(9685),a=l(1201),s=l(3958),d=l(7266),c=l(9455),o=l(4247),u=l(9749),x=l(1844),m=l(7207),f=l.n(m),h=l(5819),v=l(8591),p=l.n(v),g=l(8919);let j=e=>(0,n.jsxs)("div",{className:"w-full flex flex-col gap-2.5",children:[(0,n.jsxs)("span",{className:"font-normal leading-6 text-[16px]",children:[e.title,"："]}),e.children]}),N=e=>(0,n.jsx)("div",{className:"font-normal leading-[21.79px] text-[16px] text-gray-9",children:e.value});var w=e=>{var t,l,r,m,v,w,b;let{closeModal:y,recordId:k,type:C="new"}=e,F=(0,i.useRef)(null),{userData:I}=(0,s.oR)(),{isLoading:_,data:R}=(0,u.H4)(k),{isLoading:U,data:T}=(0,u.We)("new"===C||"editor"===C),{isLoading:L,data:z}=(0,u.Tz)("new"===C||"editor"===C),S=_||U||L,D=(0,i.useMemo)(()=>[(T||[]).map(e=>({...e,text:e.loadName})),f().findIndex(T,e=>e.loadNumber===(null==R?void 0:R.loadNumber))],[T,R]),E=(0,o.dW)(...D),Z=(0,i.useMemo)(()=>[(z||[]).map(e=>({...e,text:e.name})),f().findIndex(z,e=>{var t;return e.id===(null==R?void 0:null===(t=R.verifyUser)||void 0===t?void 0:t.id)})],[z,R]),P=(0,o.dW)(...Z),[M,W]=(0,g.Z)({verifyState:!0}),[A,H]=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=(0,i.useRef)(new AbortController);return[l=>{let n=l,r=()=>{if(0===n.length)return;let e=n[0];return n=f().drop(n),{file:e,index:l.length-n.length-1}},i=f().min([e,n.length]),a=f().range(l.length),s=async()=>{for(;;){let e=r();if(!e)return;{let{file:l,index:n}=e,r=await (0,x.qM)(l,{signal:t.current.signal});a[n]=r}}};return Promise.all(f().range(i).map(()=>s())).then(()=>a)},()=>{try{t.current.abort()}catch(e){console.info("abort upfiles")}}]}();(0,i.useEffect)(()=>H,[]);let O=!M.files||0===M.files.length||M.files.length>20||f().findIndex(M.files,e=>e.size>=2147483648||e.name.length>=128)>=0,B=!T||!z||!M.name||E.current<0||P.current<0||O,[K,Q]=(0,i.useState)(!1),X=!R||!T||!z||(M.name||R.name)===R.name&&(M.desc||R.description)===R.description&&(null===(t=T[E.current])||void 0===t?void 0:t.loadNumber)===R.loadNumber&&(null===(l=z[P.current])||void 0===l?void 0:l.id)===R.verifyUserId&&O,q=!R||O,J={directory:"",webkitdirectory:""},Y="w-full shrink-0 px-5 border border-[#DDDDDD]  h-[50px]  bg-[#F8F8F8] rounded-lg",G="verify"===C,V=(0,i.useMemo)(()=>{var e;if(O||!M.files)return"验证文件";let t=(null===(e=M.files.item(0))||void 0===e?void 0:e.webkitRelativePath.split("/")[0])||"验证文件";return(0,h.lS)(t,10,10)},[M.files,O]),$=()=>(0,n.jsx)(j,{title:G?"验证文档":"附件",children:(0,n.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,n.jsx)("input",{...J,ref:F,type:"file",hidden:!0,onChange:e=>W({files:e.target.files})}),(0,n.jsx)("img",{src:"/vector_icon.svg"}),(0,n.jsx)(N,{value:V}),(0,n.jsx)("div",{onClick:e=>{var t;return!K&&(null===(t=F.current)||void 0===t?void 0:t.click())},className:p()("flex  rounded-[4px] leading-4 text-[16px] bg-[#F1F1F1] w-[100px] h-[24px]  text-center items-center justify-center ",K?"cursor-not-allowed":"cursor-pointer"),children:"选择文件夹"})]})});return(0,n.jsx)(i.Fragment,{children:(0,n.jsxs)(c.u_,{className:"rounded-lg",containerClassName:"mx-5 max-w-[640px]",titleClassName:"text-[20px] leading-5 font-bold",title:"new"===C?"新建验证记录":"编辑验证记录",onClose:y,children:[(0,n.jsxs)("div",{className:"flex flex-col py-[1px] gap-5 px-5 w-[640px] min-h-[6.25rem] max-h-mc overflow-y-auto",children:[S&&(0,n.jsx)(d.g,{}),!S&&(0,n.jsx)(n.Fragment,{children:G?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(j,{title:"验证记录",children:(0,n.jsx)(N,{value:null==R?void 0:R.name})}),(0,n.jsx)(j,{title:"验证记录ID",children:(0,n.jsx)(N,{value:null==R?void 0:R.id})}),(0,n.jsx)(j,{title:"发起人",children:(0,n.jsx)(N,{value:null==R?void 0:null===(r=R.createUser)||void 0===r?void 0:r.name})}),(0,n.jsx)(j,{title:"组织机构",children:(0,n.jsx)(N,{value:null==R?void 0:null===(m=R.organization)||void 0===m?void 0:m.name})}),(0,n.jsx)(j,{title:"描述",children:(0,n.jsx)(N,{value:null==R?void 0:R.description})}),(0,n.jsx)(j,{title:"碳足迹批次",children:(0,n.jsx)(N,{value:null==R?void 0:null===(v=R.inventory)||void 0===v?void 0:v.loadName})}),(0,n.jsx)(j,{title:"碳足迹批次ID",children:(0,n.jsx)(N,{value:null==R?void 0:R.loadNumber})}),(0,n.jsx)(j,{title:"验证人",children:(0,n.jsx)(N,{value:null==R?void 0:null===(w=R.verifyUser)||void 0===w?void 0:w.name})}),$()]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(j,{title:"验证记录",children:(0,n.jsx)("input",{value:M.name||(null==R?void 0:R.name),onChange:e=>W({name:e.target.value}),maxLength:30,className:Y})}),(0,n.jsx)(j,{title:"碳足迹批次",children:(0,n.jsx)(o.ub,{...E})}),(0,n.jsx)(j,{title:"描述",children:(0,n.jsx)("input",{value:M.desc||(null==R?void 0:R.description),onChange:e=>W({desc:e.target.value}),maxLength:100,className:Y})}),(0,n.jsx)(j,{title:"选择验证人",children:(0,n.jsx)(o.ub,{...P})}),(0,n.jsx)(j,{title:"发起人",children:(0,n.jsx)(N,{value:null==I?void 0:I.name})}),(0,n.jsx)(j,{title:"组织机构",children:(0,n.jsx)(N,{value:null==I?void 0:null===(b=I.organization)||void 0===b?void 0:b.name})}),$()]})})]}),!S&&(0,n.jsxs)("div",{className:"flex flex-row justify-between gap-5 mt-5 w-full px-5",children:["new"===C&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.u,{defStyle:"btn-primary-1",className:"flex-1",onClick:()=>y(!1),children:"取消"}),(0,n.jsx)(a.u,{busy:K,disabled:B,defStyle:"btn-primary",className:"flex-1",onClick:()=>{B||K||(Q(!0),A(M.files).then(e=>(0,x._Q)({name:M.name,loadNumber:T[E.current].loadNumber,description:M.desc||"",fileList:e,verifyUserId:z[P.current].id}).then(()=>y(!0)).catch(console.error).finally(()=>{Q(!1)})))},children:"确定"})]}),"editor"===C&&(0,n.jsx)(a.u,{busy:K,disabled:X,className:"flex-1",onClick:()=>{X||K||(Q(!0),(M.files?A(M.files).then(e=>(0,x.u_)(R.id,{name:M.name||R.name,loadNumber:T[E.current].loadNumber,description:M.desc||R.description,fileList:e,verifyUserId:z[P.current].id})):(0,x.u_)(R.id,{name:M.name,loadNumber:T[E.current].loadNumber,description:M.desc,verifyUserId:z[P.current].id})).then(()=>y(!0)).catch(console.error).finally(()=>{Q(!1)}))},children:"提交更新"}),"verify"===C&&(0,n.jsx)(a.u,{busy:K,disabled:q,className:"flex-1",onClick:()=>{q||!M.files||K||(Q(!0),A(M.files).then(e=>(0,x.A6)(R.id,e,!0)).then(()=>y(!0)).catch(console.error).finally(()=>{Q(!1)}))},children:"提交验证"})]})]})})},b=l(905),y=l.n(b),k=e=>{let{closeModal:t,fileList:l}=e,[r,a]=(0,i.useState)(!1),d=(0,s.h3)(),o=async()=>{a(!0);try{let e=new(y()),t="";l.forEach(l=>{t=l.fileName.split("/")[0],e.file(l.fileName,l.downloadUrl)});let n=await e.generateAsync({type:"blob"}),r=document.createElement("a");r.href=URL.createObjectURL(n),r.download="".concat(t,".zip"),r.click(),URL.revokeObjectURL(r.href)}catch(e){d("文件下载出错！")}finally{a(!1)}};return(0,n.jsx)(i.Fragment,{children:(0,n.jsxs)(c.u_,{onClose:t,title:"查看文件夹",children:[(0,n.jsx)("div",{className:"px-5 overflow-y-auto  max-h-[260px]",children:l.map((e,t)=>{let l=e.fileName.split("/");return(0,n.jsx)("div",{id:"view",className:"w-[640px] h-[34px] flex items-center ",children:(0,n.jsx)("span",{className:"ml-[10px] leading-5 text-[16px] font-normal",children:l[l.length-1]})},"file_".concat(t))})}),(0,n.jsx)("button",{disabled:r,className:"bg-[#29953A] w-full h-[50px] rounded-lg text-[#FFFFFF] mt-5",onClick:o,children:"下载"})]})})},C=l(8172),F=l(3140);async function I(e){var t;let l=await C.default.get((t="/api/verifyRecord/list/?pageNum=".concat(e,"&pageSize=10"),"".concat(F.Sg).concat(t)),function(){let e=(0,s.is)();return e?{headers:{Authorization:"Bearer ".concat(e.loginToken)}}:{}}());return function(e){var t;let l=e.data;if(!l||1e5!==l.code)throw l.message;return null===(t=e.data)||void 0===t?void 0:t.data}(l)}var _=l(3187),R=l(8344),U=function(){let{userData:e}=(0,s.oR)(),[t,l]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!1),o=(0,i.useRef)([]),u=(0,i.useRef)(),x=(0,i.useRef)(),m=e=>{o.current=e,c(!0)},v=(0,i.useCallback)(t=>{l(!0),x.current={type:f().isEmpty(t)?"new":(null==e?void 0:e.role)==="verify"?"verify":"editor",recordId:t.id}},[e]),p=[{title:"验证记录",dataIndex:"name",width:"10rem",render:e=>{let t={title:e,arrow:!0,disabled:e.length<20,followCursor:!0,theme:"light",className:"w-[13rem] text-lg leading-[27px] truncate inline-block"};return(0,n.jsxs)(R.Tooltip,{...t,children:[" ",e]})}},{title:"验证记录ID",dataIndex:"id",width:"6rem",render:e=>(0,n.jsx)("div",{className:"flex  text-lg leading-[27px]  w-[6rem]",children:(0,n.jsx)("span",{className:"",children:e})})},{title:"发起人",dataIndex:"loadNumber",width:"8rem",render:(e,t)=>{let l={title:t.createUser.name,arrow:!0,disabled:t.createUser.name.length<20,followCursor:!0,theme:"light",className:"text-lg leading-[27px] max-w-[13rem]  truncate inline-block"};return(0,n.jsxs)(R.Tooltip,{...l,children:[" ",t.createUser.name]})}},{title:"组织机构",width:"2rem",dataIndex:"productName",render:(e,t)=>(0,n.jsx)("span",{className:" text-lg leading-[27px] max-w-[14rem] truncate inline-block ",children:t.organization.name})},{title:"碳足迹批次",dataIndex:"loadName",width:"10rem",render:(e,t)=>{let l={title:t.inventory.loadName,arrow:!0,theme:"light",followCursor:!0,disabled:t.inventory.loadName.length<11,className:"w-[13rem] text-lg leading-[27px] truncate inline-block"};return(0,n.jsx)(R.Tooltip,{...l,children:t.inventory.loadName})}},{title:"碳足迹批次ID",dataIndex:"loadNumber",width:"10rem",render:e=>(0,n.jsxs)(R.Tooltip,{title:e,arrow:!0,followCursor:!0,theme:"light",className:"w-[13rem] text-lg leading-[27px] truncate inline-block",children:[" ",(0,h.lS)(e,8,8)]})},{title:"附件",dataIndex:"productDescription",width:"18.75rem",render:(e,t)=>(0,n.jsxs)("div",{onClick:()=>m(t.attachmentFileList),className:"w-[112px] flex flex-row bg-[#F1F1F1] justify-center rounded cursor-pointer",children:[(0,n.jsx)("img",{src:"/vector_icon.svg"}),(0,n.jsx)("div",{className:"ml-2 ",children:"文件夹"})]})},{title:"最后编辑",dataIndex:"updateTime",width:"14rem",render:e=>(0,n.jsx)("span",{className:" text-lg leading-[27px] w-[12rem] ",children:e})},{title:"验证人",dataIndex:"name",width:"18.625rem",render:(e,t)=>{let l={title:t.verifyUser.name,arrow:!0,disabled:t.verifyUser.name.length<11,followCursor:!0,theme:"light",className:"max-w-[11rem] text-lg leading-[27px]  truncate inline-block"};return(0,n.jsxs)(R.Tooltip,{...l,children:[" ",t.verifyUser.name]})}},{title:"验证文档",dataIndex:"verifyFileList",width:"8.125rem",render:(e,t)=>t.verifyFileList.length?(0,n.jsxs)("div",{onClick:()=>m(t.verifyFileList),className:"w-[112px] flex flex-row bg-[#F1F1F1] justify-center rounded cursor-pointer",children:[(0,n.jsx)("img",{src:"/vector_icon.svg"}),(0,n.jsx)("div",{className:"ml-2 ",children:"文件夹"})]}):null},{title:"验证状态",dataIndex:"state",width:"8.125rem",render:e=>(0,n.jsx)("div",{className:" text-lg leading-[27px] max-w-[14rem] ",children:e?"已验证":""})},{title:"验证时间",dataIndex:"proofTime",width:"8.125rem",render:e=>(0,n.jsx)("span",{className:"text-lg leading-[27px] w-[13rem] ",children:e})},{title:"",width:"20rem",dataIndex:"",render:(e,t)=>!t.state&&(0,n.jsx)("div",{className:"flex justify-between flex-1 text-green-2 break-keep",children:(0,n.jsx)("div",{className:"flex items-center font-normal justify-center cursor-pointer text-lg leading-[27px]",onClick:()=>v(t),children:"编辑"})})}];return(0,n.jsxs)(r.m,{isNew:!0,className:"flex flex-col justify-between flex-1 text-black ",canBack:!0,link:{pathName:"/tools/tools",homeTitle:"产品碳足迹工具集",currentTitle:"验证管理"},children:[(0,n.jsx)("div",{children:(0,n.jsx)(_.i,{columns:p,columnsHeight:"h-[3.125rem] ",mouseHoverKey:"id",headerTitle:(0,n.jsxs)("h3",{className:"flex items-center justify-between mb-5 text-2xl font-semibold",children:[(0,n.jsx)("span",{children:"验证管理列表"}),(null==e?void 0:e.role)==="admin"&&(0,n.jsx)(a.z,{onClick:()=>v({}),className:"w-40 text-lg font-normal text-white rounded-lg bg-green-2 h-11",children:"新建验证记录"})]}),tableRef:u,api:I,className:"",columnsClassName:" cursor-default ",headerClassName:{background:"#fff",fontWeight:"700",fontSize:"18px",lineHeight:"27px"}})}),t&&x.current&&(0,n.jsx)(w,{type:x.current.type,recordId:x.current.recordId,closeModal:()=>{var e;null===(e=u.current)||void 0===e||e.reload(1),l(!1),x.current=void 0}}),d&&(0,n.jsx)(k,{fileList:o.current,closeModal:()=>{c(!1)}})]})}}},function(e){e.O(0,[3268,1271,7588,7038,8635,5070,6631,8352,8761,3187,9774,2888,179],function(){return e(e.s=2792)}),_N_E=e.O()}]);