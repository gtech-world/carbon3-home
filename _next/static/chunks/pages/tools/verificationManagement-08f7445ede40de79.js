(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9075],{2792:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tools/verificationManagement",function(){return n(9233)}])},4247:function(e,t,n){"use strict";n.d(t,{Ph:function(){return x},dW:function(){return u},ub:function(){return m}});var l=n(3342),i=n(5361),a=n(8591),r=n.n(a),s=n(9685),o=n(5295),d=n(2239),c=n(6852);function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,[n,l]=(0,s.useState)(t);return(0,s.useEffect)(()=>{l(t)},[e,t]),{onChange:l,items:e,current:n}}function x(e){let{items:t,current:n,onChange:a,className:u="bg-white text-black px-5 py-3 text-lg rounded-lg w-[31.25rem] mo:w-full mo:text-sm",currentClassName:x="flex justify-between items-center",openClassName:m="max-h-[18rem] bg-white  rounded-lg py-3 "}=e,f=t[n]?t[n].text:"",[h,v]=(0,d.Z)(!1),p=(0,s.useCallback)(e=>{n!==e&&a(e)},[n]),g=(0,i.E)("t-side");return((0,c.Z)(g,()=>h&&v(!1)),0===t.length)?null:(0,l.jsxs)("div",{ref:g,className:r()("relative cursor-pointer",u),onClick:()=>v(),children:[(0,l.jsxs)("div",{className:x,children:[(0,l.jsx)("span",{className:"truncate",children:f}),h?(0,l.jsx)(o.pzk,{}):(0,l.jsx)(o._i7,{})]}),h&&(0,l.jsx)("div",{className:r()("absolute z-[100] left-0 w-full overflow-x-hidden overflow-y-auto",m),style:{boxShadow:"0px 5px 15px rgba(0, 0, 0, 0.15)",top:"calc(100% + 8px)"},children:(0,l.jsx)("div",{className:"",children:t.map((e,t)=>(0,l.jsx)("div",{style:{},className:r()("w-full break-all px-5 py-2 text-sm hover:bg-gray-16",{"text-green-2":t===n}),onClick:()=>p(t),children:e.text},"select_item_".concat(t)))})})]})}let m=e=>(0,l.jsx)(x,{className:"h-[50px] px-5 items-center bg-stone-50 rounded-lg border border-neutral-200",currentClassName:"h-full flex justify-between items-center",...e})},9749:function(e,t,n){"use strict";n.d(t,{H4:function(){return s},Kv:function(){return r},Tz:function(){return d},We:function(){return o}});var l=n(7207),i=n.n(l),a=n(6631);function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,a.ZP)("/api/product-system/".concat(e,"/detail"),{refreshInterval:t})}function s(e){return(0,a.ZP)(i().isNil(e)?null:"/api/verifyRecord/".concat(e,"/detail"))}function o(e){return(0,a.ZP)(e?"/api/inventory/all":null)}function d(e){return(0,a.ZP)(e?"/api/verifyRecord/verifiers":null)}},1645:function(e,t,n){"use strict";n.d(t,{Yu:function(){return o},aH:function(){return s},pd:function(){return d},uJ:function(){return r}});var l=n(3958),i=n(8172),a=n(3140);function r(e){return"".concat(a.Sg).concat(e)}function s(){let e=(0,l.is)();return e?{headers:{Authorization:"Bearer ".concat(e.loginToken)}}:{}}function o(e){var t;let n=e.data;if(!n||1e5!==n.code)throw n.message;return null===(t=e.data)||void 0===t?void 0:t.data}async function d(e){let t=await i.default.get(r("/api/verifyRecord/list/?pageNum=".concat(e,"&pageSize=10")),s());return o(t)}},9233:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return U}});var l=n(3342),i=n(124),a=n(9685),r=n(3956),s=n(7921),o=n(1201),d=n(3958),c=n(7266),u=n(9455),x=n(4247),m=n(9749),f=n(1844),h=n(7207),v=n.n(h),p=n(5819),g=n(8591),j=n.n(g),N=n(8919);let w=e=>(0,l.jsxs)("div",{className:"w-full flex flex-col gap-2.5",children:[(0,l.jsxs)("span",{className:"font-normal leading-6 text-[16px]",children:[e.title,"："]}),e.children]}),y=e=>(0,l.jsx)("div",{className:"font-normal leading-[21.79px] text-[16px] text-gray-9",children:e.value});var b=e=>{var t,n,i,r,s,h,g;let{closeModal:b,recordId:k,type:C="new"}=e,F=(0,a.useRef)(null),{userData:I}=(0,d.oR)(),{isLoading:_,data:U}=(0,m.H4)(k),{isLoading:L,data:T}=(0,m.We)("new"===C||"editor"===C),{isLoading:S,data:E}=(0,m.Tz)("new"===C||"editor"===C),D=_||L||S,z=(0,a.useMemo)(()=>[(T||[]).map(e=>({...e,text:e.loadName})),v().findIndex(T,e=>e.loadNumber===(null==U?void 0:U.loadNumber))],[T,U]),B=(0,x.dW)(...z),R=(0,a.useMemo)(()=>[(E||[]).map(e=>({...e,text:e.name})),v().findIndex(E,e=>{var t;return e.id===(null==U?void 0:null===(t=U.verifyUser)||void 0===t?void 0:t.id)})],[E,U]),P=(0,x.dW)(...R),[M,Z]=(0,N.Z)({verifyState:!0}),[H,W]=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=(0,a.useRef)(new AbortController);return[n=>{let l=n,i=()=>{if(0===l.length)return;let e=l[0];return l=v().drop(l),{file:e,index:n.length-l.length-1}},a=v().min([e,l.length]),r=v().range(n.length),s=async()=>{for(;;){let e=i();if(!e)return;{let{file:n,index:l}=e,i=await (0,f.qM)(n,{signal:t.current.signal});r[l]=i}}};return Promise.all(v().range(a).map(()=>s())).then(()=>r)},()=>{try{t.current.abort()}catch(e){console.info("abort upfiles")}}]}();(0,a.useEffect)(()=>W,[]);let A=!M.files||0===M.files.length||M.files.length>20||v().findIndex(M.files,e=>e.size>=2147483648||e.name.length>=128)>=0,O=!T||!E||!M.name||B.current<0||P.current<0||A,[K,X]=(0,a.useState)(!1),q=!U||!T||!E||(M.name||U.name)===U.name&&(M.desc||U.description)===U.description&&(null===(t=T[B.current])||void 0===t?void 0:t.loadNumber)===U.loadNumber&&(null===(n=E[P.current])||void 0===n?void 0:n.id)===U.verifyUserId&&A,J=!U||A||!M.functionalUnit||!M.evaluationBoundary||!M.evaluationBasis||!M.evaluationExpireTime,Q={directory:"",webkitdirectory:""},Y="w-full shrink-0 px-5 border border-[#DDDDDD]  h-[50px]  bg-[#F8F8F8] rounded-lg",G="verify"===C,V=(0,a.useMemo)(()=>{var e;if(A||!M.files)return"验证文件";let t=(null===(e=M.files.item(0))||void 0===e?void 0:e.webkitRelativePath.split("/")[0])||"验证文件";return(0,p.lS)(t,10,10)},[M.files,A]),$=()=>(0,l.jsx)(w,{title:G?"验证文档":"附件",children:(0,l.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,l.jsx)("input",{...Q,ref:F,type:"file",hidden:!0,onChange:e=>Z({files:e.target.files})}),(0,l.jsx)("img",{src:"/vector_icon.svg"}),(0,l.jsx)(y,{value:V}),(0,l.jsx)("div",{onClick:e=>{var t;return!K&&(null===(t=F.current)||void 0===t?void 0:t.click())},className:j()("flex  rounded-[4px] leading-4 text-[16px] bg-[#F1F1F1] w-[100px] h-[24px]  text-center items-center justify-center ",K?"cursor-not-allowed":"cursor-pointer"),children:"选择文件夹"})]})});return(0,l.jsx)(a.Fragment,{children:(0,l.jsxs)(u.u_,{className:"rounded-lg",containerClassName:"mx-5 max-w-[640px]",titleClassName:"text-[20px] leading-5 font-bold",title:"new"===C?"新建验证记录":"编辑验证记录",onClose:b,children:[(0,l.jsxs)("div",{className:"flex flex-col py-[1px] gap-5 px-5 w-[640px] min-h-[6.25rem] max-h-mc overflow-y-auto",children:[D&&(0,l.jsx)(c.g,{}),!D&&(0,l.jsx)(l.Fragment,{children:G?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(w,{title:"验证记录",children:(0,l.jsx)(y,{value:null==U?void 0:U.name})}),(0,l.jsx)(w,{title:"验证记录ID",children:(0,l.jsx)(y,{value:null==U?void 0:U.id})}),(0,l.jsx)(w,{title:"发起人",children:(0,l.jsx)(y,{value:null==U?void 0:null===(i=U.createUser)||void 0===i?void 0:i.name})}),(0,l.jsx)(w,{title:"组织机构",children:(0,l.jsx)(y,{value:null==U?void 0:null===(r=U.organization)||void 0===r?void 0:r.name})}),(0,l.jsx)(w,{title:"描述",children:(0,l.jsx)(y,{value:null==U?void 0:U.description})}),(0,l.jsx)(w,{title:"碳足迹批次",children:(0,l.jsx)(y,{value:null==U?void 0:null===(s=U.inventory)||void 0===s?void 0:s.loadName})}),(0,l.jsx)(w,{title:"碳足迹批次ID",children:(0,l.jsx)(y,{value:null==U?void 0:U.loadNumber})}),(0,l.jsx)(w,{title:"验证人",children:(0,l.jsx)(y,{value:null==U?void 0:null===(h=U.verifyUser)||void 0===h?void 0:h.name})}),$(),(0,l.jsx)(w,{title:"功能单位",children:(0,l.jsx)("input",{value:M.functionalUnit||(null==U?void 0:U.functionalUnit),onChange:e=>Z({functionalUnit:e.target.value}),maxLength:30,className:Y})}),(0,l.jsx)(w,{title:"评价边界",children:(0,l.jsx)("input",{value:M.evaluationBoundary||(null==U?void 0:U.evaluationBoundary),onChange:e=>Z({evaluationBoundary:e.target.value}),maxLength:30,className:Y})}),(0,l.jsx)(w,{title:"评价依据",children:(0,l.jsx)("input",{value:M.evaluationBasis||(null==U?void 0:U.evaluationBasis),onChange:e=>Z({evaluationBasis:e.target.value}),maxLength:30,className:Y})}),(0,l.jsx)(w,{title:"评价有效期",children:(0,l.jsx)("input",{style:{color:"#DDDDDD"},value:M.evaluationExpireTime||(null==U?void 0:U.evaluationExpireTime),type:"date",id:"dateCheck",onChange:e=>{console.info("inputTime:",e.target.value),Z({evaluationExpireTime:e.target.value})},maxLength:30,className:Y})})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(w,{title:"验证记录",children:(0,l.jsx)("input",{value:M.name||(null==U?void 0:U.name),onChange:e=>Z({name:e.target.value}),maxLength:30,className:Y})}),(0,l.jsx)(w,{title:"碳足迹批次",children:(0,l.jsx)(x.ub,{...B})}),(0,l.jsx)(w,{title:"描述",children:(0,l.jsx)("input",{value:M.desc||(null==U?void 0:U.description),onChange:e=>Z({desc:e.target.value}),maxLength:100,className:Y})}),(0,l.jsx)(w,{title:"选择验证人",children:(0,l.jsx)(x.ub,{...P})}),(0,l.jsx)(w,{title:"发起人",children:(0,l.jsx)(y,{value:null==I?void 0:I.name})}),(0,l.jsx)(w,{title:"组织机构",children:(0,l.jsx)(y,{value:null==I?void 0:null===(g=I.organization)||void 0===g?void 0:g.name})}),$()]})})]}),!D&&(0,l.jsxs)("div",{className:"flex flex-row justify-between gap-5 mt-5 w-full px-5",children:["new"===C&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.u,{defStyle:"btn-primary-1",className:"flex-1",onClick:()=>b(!1),children:"取消"}),(0,l.jsx)(o.u,{busy:K,disabled:O,defStyle:"btn-primary",className:"flex-1",onClick:()=>{O||K||(X(!0),H(M.files).then(e=>(0,f._Q)({name:M.name,loadNumber:T[B.current].loadNumber,description:M.desc||"",fileList:e,verifyUserId:E[P.current].id}).then(()=>b(!0)).catch(console.error).finally(()=>{X(!1)})))},children:"确定"})]}),"editor"===C&&(0,l.jsx)(o.u,{busy:K,disabled:q,className:"flex-1",onClick:()=>{q||K||(X(!0),(M.files?H(M.files).then(e=>(0,f.u_)(U.id,{name:M.name||U.name,loadNumber:T[B.current].loadNumber,description:M.desc||U.description,fileList:e,verifyUserId:E[P.current].id})):(0,f.u_)(U.id,{name:M.name,loadNumber:T[B.current].loadNumber,description:M.desc,verifyUserId:E[P.current].id})).then(()=>b(!0)).catch(console.error).finally(()=>{X(!1)}))},children:"提交更新"}),"verify"===C&&(0,l.jsx)(o.u,{busy:K,disabled:J,className:"flex-1",onClick:()=>{J||!M.files||K||(X(!0),H(M.files).then(e=>(0,f.A6)(U.id,{fileList:e,state:!0,functionalUnit:M.functionalUnit,evaluationBoundary:M.evaluationBoundary,evaluationBasis:M.evaluationBasis,evaluationExpireTime:M.evaluationExpireTime+" 00:00:00"})).then(()=>b(!0)).catch(console.error).finally(()=>{X(!1)}))},children:"提交验证"})]})]})})},k=n(905),C=n.n(k),F=e=>{let{closeModal:t,fileList:n}=e,[i,r]=(0,a.useState)(!1),s=(0,d.h3)(),c=async()=>{r(!0);try{let e=new(C()),t="",l=n.map(async e=>{var n;t=null==e?void 0:null===(n=e.fileName)||void 0===n?void 0:n.split("/")[0];let l=await (await fetch(e.downloadUrl)).blob();return{fileName:e.fileName,blob:l}}),i=await Promise.all(l);i.forEach(t=>{e.file(t.fileName,t.blob)});let a=await e.generateAsync({type:"blob"}),r=document.createElement("a");r.href=URL.createObjectURL(a),r.download="".concat(t,".zip"),r.click(),URL.revokeObjectURL(r.href)}catch(e){s("文件下载出错！")}finally{r(!1)}};return(0,l.jsx)(a.Fragment,{children:(0,l.jsxs)(u.u_,{onClose:t,title:"查看文件夹",children:[(0,l.jsx)("div",{className:"px-5 overflow-y-auto  max-h-[260px]",children:n.map((e,t)=>{let n=e.fileName.split("/");return(0,l.jsx)("div",{id:"view",className:"w-[640px] h-[34px] flex items-center ",children:(0,l.jsx)("span",{className:"ml-[10px] leading-5 text-[16px] font-normal",children:n[n.length-1]})},"file_".concat(t))})}),(0,l.jsx)(o.u,{busy:i,disabled:i,defStyle:"btn-primary",className:"bg-[#29953A] w-full h-[50px] rounded-lg text-[#FFFFFF] mt-5",onClick:c,children:"下载"})]})})},I=n(1645),_=n(8005),U=function(){let{userData:e}=(0,d.oR)(),[t,n]=(0,a.useState)(1),[c,u]=(0,a.useState)({}),[x,m]=(0,a.useState)(!1),[f,h]=(0,a.useState)(!1),g=(0,a.useRef)([]),[j,N]=(0,a.useState)(!1),w=(0,a.useRef)(),y=e=>{g.current=e,h(!0)},k=(0,a.useCallback)(t=>{m(!0),w.current={type:v().isEmpty(t)?"new":(null==e?void 0:e.role)==="verify"?"verify":"editor",recordId:t.id}},[e]),C=(0,a.useMemo)(()=>[{title:"验证记录",dataIndex:"name",width:"10rem",render:e=>(0,l.jsx)("span",{"data-tooltip-content":(0,_.iT)(e,20),"data-tooltip-id":"tooltip",className:"w-[13rem] text-lg leading-[27px] truncate inline-block",children:e})},{title:"验证记录ID",dataIndex:"id",width:"6rem",render:(e,t)=>(0,l.jsx)("div",{className:"flex  text-lg leading-[27px]  w-[6rem]",children:(0,l.jsx)("span",{className:"",children:e})})},{title:"发起人",dataIndex:"loadNumber",width:"8rem",render:(e,t)=>(0,l.jsx)("span",{"data-tooltip-content":(0,_.iT)(t.createUser.name,20),"data-tooltip-id":"tooltip",className:"text-lg leading-[27px] max-w-[13rem]  truncate inline-block",children:t.createUser.name})},{title:"组织机构",width:"2rem",dataIndex:"productName",render:(e,t)=>(0,l.jsx)("span",{className:" text-lg leading-[27px] max-w-[14rem] truncate inline-block ",children:t.organization.name})},{title:"碳足迹批次",dataIndex:"loadName",width:"10rem",render:(e,t)=>(0,l.jsx)("span",{"data-tooltip-content":(0,_.iT)(t.inventory.loadName,11),"data-tooltip-id":"tooltip",className:"w-[13rem] text-lg leading-[27px] truncate inline-block",children:t.inventory.loadName})},{title:"碳足迹批次ID",dataIndex:"loadNumber",width:"10rem",render:e=>(0,l.jsx)("span",{"data-tooltip-content":e,"data-tooltip-id":"tooltip",className:"w-[13rem] text-lg leading-[27px] truncate inline-block",children:(0,p.lS)(e,8,8)})},{title:"附件",dataIndex:"productDescription",width:"18.75rem",render:(e,t)=>(0,l.jsxs)("div",{onClick:()=>y(t.attachmentFileList),className:"w-[112px] flex flex-row bg-[#F1F1F1] justify-center rounded cursor-pointer",children:[(0,l.jsx)("img",{src:"/vector_icon.svg"}),(0,l.jsx)("div",{className:"ml-2 ",children:"文件夹"})]})},{title:"最后编辑",dataIndex:"updateTime",width:"14rem",render:e=>(0,l.jsx)("span",{className:" text-lg leading-[27px] w-[12rem] ",children:e})},{title:"验证人",dataIndex:"name",width:"18.625rem",render:(e,t)=>(0,l.jsx)("span",{"data-tooltip-content":(0,_.iT)(t.verifyUser.name,11),"data-tooltip-id":"tooltip",className:"max-w-[11rem] text-lg leading-[27px]  truncate inline-block",children:t.verifyUser.name})},{title:"验证文档",dataIndex:"verifyFileList",width:"8.125rem",render:(e,t)=>t.verifyFileList.length?(0,l.jsxs)("div",{onClick:()=>y(t.verifyFileList),className:"w-[112px] flex flex-row bg-[#F1F1F1] justify-center rounded cursor-pointer",children:[(0,l.jsx)("img",{src:"/vector_icon.svg"}),(0,l.jsx)("div",{className:"ml-2 ",children:"文件夹"})]}):null},{title:"验证状态",dataIndex:"state",width:"8.125rem",render:e=>(0,l.jsx)("span",{className:" text-lg leading-[27px] max-w-[14rem] ",children:e?"已验证":""})},{title:"验证时间",dataIndex:"proofTime",width:"8.125rem",render:e=>(0,l.jsx)("span",{className:"text-lg leading-[27px] w-[13rem] ",children:e})},{title:"",width:"20rem",render:(e,t)=>!t.state&&(0,l.jsx)("div",{className:"flex justify-between flex-1 text-green-2 break-keep",children:(0,l.jsx)("div",{className:"flex items-center font-normal justify-center cursor-pointer text-lg leading-[27px]",onClick:()=>k(t),children:"编辑"})})}],[k]),U=async()=>{try{N(!0);let e=await (0,I.pd)(t);u(e)}catch(e){console.log("eeee",e)}finally{N(!1)}};return(0,a.useEffect)(()=>{U()},[t]),(0,l.jsxs)(i.m,{isNew:!0,className:"flex flex-col justify-between flex-1 text-black ",canBack:!0,link:{pathName:"/tools/tools",homeTitle:"产品碳足迹工具集",currentTitle:"验证管理"},children:[(0,l.jsxs)("div",{className:"",children:[(0,l.jsxs)("h3",{className:"flex items-center justify-between text-2xl font-semibold",children:[(0,l.jsx)("span",{children:"验证管理列表"}),(null==e?void 0:e.role)==="admin"&&(0,l.jsx)(o.z,{onClick:()=>k({}),className:"w-40 text-lg font-normal text-white rounded-lg bg-green-2 h-11 hover:bg-green-28",children:"新建验证记录"})]}),(0,l.jsx)("div",{className:"w-full p-5 mt-5 bg-white rounded-2xl",children:(0,l.jsx)("div",{className:"pb-6 mt-5 overflow-x-auto",children:(0,l.jsx)("div",{className:"text-base leading-[1.625rem] min-w-[62.25rem]",children:(0,l.jsx)(r.i,{columns:C,loading:j,columnsHeight:"h-[3.125rem] ",mouseHoverKey:"id",data:(null==c?void 0:c.records)||[],className:"",columnsClassName:" cursor-default ",headerClassName:{background:"#fff",fontWeight:"700",fontSize:"18px",lineHeight:"27px"}})})})})]}),(0,l.jsx)(s.t,{className:"my-8",onChange:e=>{n(e)},total:c.total||0,pgSize:10,pgNum:t}),x&&w.current&&(0,l.jsx)(b,{type:w.current.type,recordId:w.current.recordId,closeModal:()=>{n(1),1===t&&U(),m(!1),w.current=void 0}}),f&&(0,l.jsx)(F,{fileList:g.current,closeModal:()=>{h(!1)}})]})}}},function(e){e.O(0,[3268,1271,7588,7038,8635,6933,8352,8881,8149,9774,2888,179],function(){return e(e.s=2792)}),_N_E=e.O()}]);