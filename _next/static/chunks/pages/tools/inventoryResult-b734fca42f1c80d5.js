(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1126],{6436:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tools/inventoryResult",function(){return l(4672)}])},1201:function(e,t,l){"use strict";l.d(t,{u:function(){return i},z:function(){return r}});var s=l(3342),n=l(8591),a=l.n(n),c=l(4209);function r(e){let{children:t,className:l,...n}=e;return(0,s.jsx)("button",{...n,className:a()(l),children:e.children})}function i(e){let{busy:t,disabled:l,className:n,defStyle:r="btn-primary",children:i,...o}=e;return(0,s.jsx)("button",{className:a()(n,{[r]:!l,"btn-disable":l}),...o,children:t?(0,s.jsx)(c.fCD,{className:"animate-spin"}):i})}},7266:function(e,t,l){"use strict";l.d(t,{I:function(){return i},g:function(){return r}});var s=l(3342),n=l(8591),a=l.n(n),c=l(2138);function r(e){let{className:t,color:l,size:n="",...r}=e;return(0,s.jsx)("div",{...r,className:a()("text-black w-full h-full flex items-center justify-center",t),children:(0,s.jsx)(c.uur,{color:l,style:n?{fontSize:n}:{},className:"text-[3.125rem] animate-spin"})})}function i(){return(0,s.jsx)(r,{className:"fixed z-50 left-0 top-0 w-full !h-full bg-black/25"})}},124:function(e,t,l){"use strict";l.d(t,{m:function(){return N}});var s=l(3342),n=l(107),a=l(8996),c=l(1882),r=l(3958),i=l(8591),o=l.n(i),d=l(2577),m=l(3917),u=l(5390),x=l(1608),f=l(8881);function h(e){let{children:t,className:l,tits:a,showQuery:c,isManager:i,...h}=e,{push:N}=(0,n.useRouter)(),p=(0,f.fo)();return(0,r.dD)(),(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:o()("w-full relative z-[3] max-w-[90rem] mx-auto text-white flex items-center top-0  h-[4.25rem] justify-between",l),...h,children:[(0,s.jsxs)("div",{className:"flex items-center cursor-pointer ml-[-1rem] mo:ml-0",onClick:()=>N("/"),children:[(0,s.jsx)(d.Z,{className:"h-[2.275rem] mo:h-[2rem]"}),(0,s.jsx)(m.Z,{className:"h-[1.5rem] mt-2.5 ml-3 mo:h-[1.1rem] mo:mt-3"})]}),(0,s.jsx)(u.R,{menus:p,children:(0,s.jsx)("button",{className:"text-[2rem] mo:text-2xl",children:(0,s.jsx)(x.otZ,{})})})]})})}function N(e){let{className:t,canBack:l,children:r,link:i,isNew:d,containerClassName:m,...u}=e,{push:x}=(0,n.useRouter)(),f=(0,a.R)();return(0,s.jsxs)("div",{className:"relative flex flex-col flex-1 w-full h-full min-h-fit bg-gray-16",children:[(0,s.jsx)(h,{showQuery:!0,style:{top:"".concat(f,"px")},className:"!sticky px-[3.125rem] py-4 !max-w-none bg-green-2 mo:px-4 mo:h-[4.25rem]"}),(0,s.jsxs)("div",{className:o()("w-full h-full mx-auto px-[60px] flex flex-col flex-1",m,{" max-w-[90rem]":!d}),children:[l&&(0,s.jsxs)("div",{className:"flex items-center my-5 text-sm ".concat((null==i?void 0:i.pathName)?"cursor-default":"cursor-pointer"),onClick:()=>(null==i?void 0:i.pathName)?void 0:x("/carbon/service"),children:[!i&&(0,s.jsx)(c.YFh,{className:"text-lg"}),i&&"{}"!==JSON.stringify(i)?(0,s.jsxs)("div",{className:"flex flex-row",children:[(0,s.jsx)("span",{className:"text-[#000000] cursor-pointer font-bold  text-[14px]",onClick:()=>x(null==i?void 0:i.pathName),children:i.homeTitle}),(0,s.jsx)("div",{className:"mx-1 ",children:" / "}),(0,s.jsxs)("span",{className:"cu text-[#999999] font-normal text-[14px]",children:[" ",i.currentTitle]})]}):"返回"]}),(0,s.jsx)("div",{className:o()("flex flex-col ",t),children:r})]})]})}},5109:function(e,t,l){"use strict";l.d(t,{b:function(){return a}});var s=l(1083),n=l.n(s);let a=n()(()=>Promise.all([l.e(6257),l.e(8882),l.e(9253)]).then(l.bind(l,9367)),{loadableGenerated:{webpack:()=>[9367]},ssr:!1})},4672:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return g}});var s=l(3342),n=l(1201),a=l(7266),c=l(124),r=l(5109),i=l(1844),o=l(5819),d=l(8591),m=l.n(d),u=l(7207),x=l.n(u),f=l(107),h=l(9685),N=l(3155),p=l(2239);function j(e){let[t,l]=(0,h.useState)(!0),{text:n,onChange:a}=e;return(0,h.useMemo)(()=>{a&&a(t)},[t]),(0,s.jsx)("div",{className:"inline-block font-bold",onClick:()=>l(!t),children:(0,s.jsxs)("div",{className:"flex items-center cursor-pointer",children:[(0,s.jsx)("span",{children:n}),(0,s.jsx)(N.Tgc,{height:"7px",className:m()("ml-1",!t&&"rotate-180")})]})})}function b(e){let[t,l]=(0,h.useState)(!0),{data:n}=e,a=[{label:"碳足迹批次",text:n.loadNumber},{label:"产品系统",text:n.productSystemName},{label:"目标产品",text:n.targetName},{label:"目标产品数量",text:n.targetAmount},{label:"Impact Method(环境影响评价方法)",text:"IPCC 2021"},{label:"Allocation Method(分摊方法)",text:"Process Defaults"},{label:"Cutoff",text:"none"},{label:"计算结果生成时间",text:n.calculateSuccessTime}];return(0,s.jsxs)("div",{children:[(0,s.jsx)(j,{text:"一般信息",onChange:e=>l(e)}),t&&(0,s.jsx)("div",{className:"mt-4",children:a.map((e,t)=>(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsxs)("label",{className:"",children:[e.label," :"]}),(0,s.jsx)("span",{className:"ml-1 text-gray-6",children:e.text})]},"data-".concat(t)))})]})}function v(e){let[t,l]=(0,h.useState)(!0),{data:n}=e;return(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)(j,{text:"碳足迹结果",onChange:e=>l(e)}),t&&(0,s.jsx)("div",{className:"text-[1.75rem] font-semibold mt-4",children:n})]})}var g=function(){let{query:e}=(0,f.useRouter)(),[t,l]=(0,h.useState)(!1),[d,m]=(0,h.useState)(),[u,N]=(0,h.useState)(!0),g=async()=>{let t=await (0,i.fF)(e.id);if(!t)return;let{modelBomInfo:l}=await (0,i.Yp)(t.modelId);m({lca:t,bominfo:l}),N(!1)};(0,h.useEffect)(()=>{g()},[e.id]);let{generalInfo:w,carbonResult:y,graphData:E,pieData:R}=(0,h.useMemo)(()=>{let e=[],t="",l="",s="",n="";if(d){let{lca:u,bominfo:f}=d,h=(0,o.OA)(u.lcaResult);if(h){var a,c,r,i,m;e={productSystemName:null===(a=h.extra)||void 0===a?void 0:a.productSystemName,methodName:null===(c=h.extra)||void 0===c?void 0:c.methodName,targetAmount:null===(r=h.extra)||void 0===r?void 0:r.targetAmount,calculateSuccessTime:u.calculateSuccessTime,loadNumber:u.loadNumber},t=h.totalImpacts&&(null===(i=h.totalImpacts[0])||void 0===i?void 0:i.impact.referenceUnit)||"";let s=x().round(h.totalResult||(null===(m=h.treeNode)||void 0===m?void 0:m.result)||0,2);l="".concat(s||0," ").concat(t)}let N=(0,o.OA)(f),p=(0,o.OA)(u.lcaTagResult);if(console.info("booms:",N),console.info("tagRes:",p),N&&p){s="classDiagram",n="pie title ";let l=x().groupBy(p,"flowId"),a=x().groupBy(N,"flowId"),c={bomIndex:1,stageIndex:1},r=e=>(c[e.flowId]||(c[e.flowId]="STAGE"===e.tagType?c.stageIndex++:c.bomIndex++),c[e.flowId]),i=e=>"REFERENCE"===e.tagType?"目标产品":e.tagType+r(e),o=x().sortBy(N,e=>"BOM"===e.tagType?2:"STAGE"===e.tagType?1:0);o.forEach(e=>{e.childFlowIds&&e.childFlowIds.length&&e.childFlowIds.forEach(t=>{let n=x().first(l[t]),c=x().first(a[t]);if(c&&n){let t=i(e),l=i(c);s+="\n ".concat(t," <|-- ").concat(l)}})}),o.forEach(a=>{let c=i(a),r=x().first(l[a.flowId]),o="REFERENCE"===a.tagType?(null==r?void 0:r.result)||0:((null==r?void 0:r.result)||0)-x().sumBy(a.childFlowIds,e=>{var t;return(null===(t=x().first(l[e]))||void 0===t?void 0:t.result)||0}),d=x().round(o,2),m="".concat(c," : ").concat(a.flowName.replaceAll("(","（").replaceAll(")","）"),"\n          ").concat(c," : +PCF(").concat(d," ").concat(t,")");("REFERENCE"!==a.tagType||a.childFlowIds.length>0)&&(s+="\n".concat(m)),"REFERENCE"===a.tagType?(n+=a.flowName,e.targetName=a.flowName):n+='\n"'.concat(a.flowName,'":').concat(d)})}}return console.info("gD:",s),{generalInfo:e,carbonResult:l,graphData:s,pieData:n}},[d]),C=async()=>{if(!e.id)return!1;l(!0);let t=await (0,i.LW)(e.id);if(t.headers){let e=t.headers.get("content-disposition");if(e){let s=e.match(/filename=(.+)/);if(s){l(!1);let e=new Blob([t.data]),n=document.createElement("a");n.download=s[1],n.style.display="none",n.href=URL.createObjectURL(e),document.body.appendChild(n),n.click(),URL.revokeObjectURL(n.href),document.body.removeChild(n)}}}},[I,F]=(0,p.Z)(!0);return(0,s.jsx)(c.m,{className:"text-lg text-black",children:u?(0,s.jsx)("div",{className:"h-[100vh] w-full items-center",children:(0,s.jsx)(a.g,{})}):(0,s.jsxs)("div",{className:"mo:break-all",children:[(0,s.jsx)("h3",{className:"my-5 text-2xl font-semibold",children:"碳足迹结果"}),(0,s.jsxs)("div",{className:"p-5 bg-white rounded-2xl",children:[(0,s.jsx)(b,{data:w}),(0,s.jsx)(v,{data:y}),!x().isEmpty(E)&&!x().isEmpty(R)&&(0,s.jsxs)("div",{className:"w-full mt-4",children:[(0,s.jsx)(j,{text:"BOM/STAGE的明细结果",onChange:e=>F(e)}),I&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.b,{className:"w-full h-[320px] bg-[#F1F1F1] mt-4",data:E}),(0,s.jsx)(r.b,{className:"w-full h-[320px] bg-[#F1F1F1] mt-4",data:R})]})]})]}),(0,s.jsx)("div",{className:"flex justify-center w-full mt-5 mb-10",children:(0,s.jsx)(n.z,{onClick:()=>!t&&C(),className:"mt-5 text-lg bg-green-2 w-[26.875rem] text-white rounded-lg  h-14 flex items-center justify-center hover:bg-green-28",children:t?(0,s.jsx)("div",{children:(0,s.jsx)(a.g,{size:"2rem",color:"#fff"})}):(0,s.jsx)("span",{children:"导出Excel"})})})]})})}}},function(e){e.O(0,[3268,1271,7588,7038,8635,976,7614,8881,9774,2888,179],function(){return e(e.s=6436)}),_N_E=e.O()}]);