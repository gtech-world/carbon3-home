(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1126],{7959:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tools/inventoryResult",function(){return l(2545)}])},1191:function(e,t,l){"use strict";l.d(t,{u:function(){return d},z:function(){return i}});var s=l(1527),a=l(4875),n=l.n(a),r=l(5591);function i(e){let{children:t,className:l,...a}=e;return(0,s.jsx)("button",{...a,className:n()(l,"hover:bg-green-28"),children:e.children})}function d(e){let{busy:t,disabled:l,className:a,defStyle:i="btn-primary",children:d,...c}=e;return(0,s.jsx)("button",{className:n()(a,{[i]:!l,"btn-disable":l}),...c,children:t?(0,s.jsx)(r.fCD,{className:"animate-spin"}):d})}},5858:function(e,t,l){"use strict";l.d(t,{I:function(){return d},g:function(){return i}});var s=l(1527),a=l(4875),n=l.n(a),r=l(1671);function i(e){let{className:t,color:l,size:a="",...i}=e;return(0,s.jsx)("div",{...i,className:n()("text-black w-full h-full flex items-center justify-center",t),children:(0,s.jsx)(r.uur,{color:l,style:a?{fontSize:a}:{},className:"text-[3.125rem] animate-spin"})})}function d(){return(0,s.jsx)(i,{className:"fixed z-50 left-0 top-0 w-full !h-full bg-black/25"})}},9346:function(e,t,l){"use strict";l.d(t,{i:function(){return x}});var s=l(1527),a=l(4875),n=l.n(a),r=l(4323),i=l(1875),d=l(959),c=l(5858),o=l(8723),m=l(9401);let x=e=>{let{columns:t,data:l,className:a,cellClassName:x,headerClassName:u,size:h="",maxHeight:p,loading:f=!1,hiddenHeader:j=!1,mouseHoverKey:v="",columnsHeight:N="",isSetBorder:b=!1,tableId:g}=e,[w,y]=(0,d.useState)(l||[]),[I,k]=(0,d.useState)({}),[C,F]=(0,d.useState)({}),S=(0,d.useRef)(null);(0,o.Z)(S,()=>{for(let e in I)I[e]&&(I[e].isFilterOpen=!1,k({...I}))}),(0,d.useEffect)(()=>{y(l)},[l]),(0,d.useEffect)(()=>{t.map(e=>{if(e.filterOptions){var t;I[e.dataIndex]={isFilterOpen:!1,filterValueIndex:(null===(t=I[e.dataIndex])||void 0===t?void 0:t.filterValueIndex)>-1?I[e.dataIndex].filterValueIndex:-1}}}),k(I)},[t]);let O=e=>{if(void 0===w[e].level&&(w[e].level=0),w[e].children.map(t=>{t.level=w[e].level+1}),w[e].open=!w[e].open,w[e].open)y(w.slice(0,e+1).concat(w[e].children).concat(w.slice(e+1)));else{let t=w[e].children.length;w[e].children.map(e=>{e.open&&(e.open=!1,t+=e.children.length)}),w.splice(e+1,t),y([...w])}},A=(e,t)=>{Object.assign(I,{[e.dataIndex]:{filterValueIndex:t,isFilterOpen:!1}}),e.onFilterChange&&e.onFilterChange(t>-1?e.filterOptions[t]:null),k(I)},_=e=>{I[e.dataIndex].isFilterOpen=!I[e.dataIndex].isFilterOpen,k({...I})};return(0,s.jsxs)("div",{className:n()("w-full",a,"small"===h&&"text-xs","big"===h&&"text-lg mo:text-[.9375rem] "),children:[(0,s.jsxs)("table",{border:1,cellSpacing:0,className:"w-full text-left ",id:g,children:[!j&&(0,s.jsx)("thead",{className:n()("bg-gray-14 ",{"border bg-[#E5E5E5]":b},a,"small"===h&&"text-sm"),style:u,children:(0,s.jsx)("tr",{className:"px-3",children:t&&t.map((e,l)=>{var a;return(0,s.jsxs)("th",{style:{width:e.width?e.width:"auto"},className:n()("px-3 relative break-keep",0===l&&" ".concat(!b&&"rounded-l"||""," overflow-hidden"),l===t.length-1&&"".concat(!b&&"rounded-r"||""," overflow-hidden"),m.NO[h]||"py-2"),children:[!!e.tip&&(0,s.jsx)(r.gL9,{"data-tooltip-id":"tooltip","data-tooltip-content":e.tip,className:"inline-block text-xl mt-[-0.15rem] mr-1"}),(0,s.jsx)("span",{children:e.title}),!!I[e.dataIndex]&&(0,s.jsxs)("div",{className:"inline-block",ref:S,children:[(0,s.jsx)(i.Ihx,{color:(null===(a=I[e.dataIndex])||void 0===a?void 0:a.filterValueIndex)>-1?"#29953A":"",onClick:()=>{_(e)},className:"inline-block text-xl mt-[-0.15rem] ml-1 cursor-pointer"}),I[e.dataIndex].isFilterOpen&&(0,s.jsx)("div",{className:"absolute left-0 font-normal top-10",children:(0,s.jsxs)("ul",{className:"bg-white w-[12.375rem] max-h-[14.875rem] overflow-auto text-sm rounded-lg py-3",style:{boxShadow:"0px 5px 15px rgba(0, 0, 0, 0.15)"},children:[(0,s.jsx)("li",{className:n()("py-2.5 px-5 hover:bg-[#F3F3F3] cursor-pointer",-1===I[e.dataIndex].filterValueIndex&&"text-green-2"),onClick:()=>{A(e,-1)},children:"All"}),e.filterOptions.map((t,l)=>(0,s.jsx)("li",{onClick:()=>{A(e,l)},className:n()("py-1.5 hover:bg-[#F3F3F3] px-5 break-all cursor-pointer",I[e.dataIndex].filterValueIndex===l?"text-green-2":""),children:t.text},"productList".concat(l)))]})})]})]},"columns".concat(l))})})}),!f&&(0,s.jsx)("tbody",{style:{maxHeight:p},className:"w-full overflow-y-auto ",children:w.map((e,l)=>(0,s.jsx)("tr",{className:" column-level-".concat(e.level?e.level:0," ").concat(N," "),children:t.map((t,a)=>(0,s.jsx)("td",{className:n()("px-3 cursor-pointer  ",{"bg-[#F3F3F3]":C[v]===e[v]&&v,border:b},m.NO[h]||"py-2",!!t.tip&&"pl-9",x&&x(t,a,l)),style:{width:t.width?t.width:"auto"},children:(0,s.jsxs)("div",{onMouseOver:()=>F(e),className:"flex items-center ",style:{marginLeft:(e.level&&0===a?e.level:0)*1.25+"rem"},children:[!!(null==e?void 0:e.children)&&(null==e?void 0:e.children.length)>0&&0===a&&(0,s.jsx)(i.Tfp,{onClick:()=>O(l),className:n()("mr-2 cursor-pointer text-gray-9",e.open&&"rotate-[90deg]")}),t.render?t.render(e[t.dataIndex],e):t.emptyText&&!e[t.dataIndex]?"-":e[t.dataIndex]]})},"data_column_".concat(a)))},"table_data_".concat(l)))})]}),f?(0,s.jsx)(c.g,{className:"pt-8"}):!(w&&w.length>0)&&(0,s.jsx)("div",{className:"flex justify-center w-full py-20",children:"无数据"})]})}},1600:function(e,t,l){"use strict";l.d(t,{m:function(){return f}});var s=l(1527),a=l(8948),n=l(7265),r=l(1875),i=l(834),d=l(4875),c=l.n(d),o=l(7478),m=l(2810),x=l(8189),u=l(5487),h=l(5283);function p(e){let{children:t,className:l,tits:n,showQuery:r,isManager:d,...p}=e,{push:f}=(0,a.useRouter)(),j=(0,h.fo)();return(0,i.dD)(),(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:c()("w-full relative z-[3] max-w-[90rem] mx-auto text-white flex items-center top-0 px-[7.5rem] h-[4.25rem] justify-between",l),...p,children:[(0,s.jsxs)("div",{className:"flex items-center cursor-pointer ml-[-1rem] mo:ml-0",onClick:()=>f("/"),children:[(0,s.jsx)(o.Z,{className:"h-[2.275rem] mo:h-[2rem]"}),(0,s.jsx)(m.Z,{className:"h-[1.5rem] mt-2.5 ml-3 mo:h-[1.1rem] mo:mt-3"})]}),(0,s.jsx)(x.R,{menus:j,children:(0,s.jsx)("button",{className:"text-[2rem] mo:text-2xl",children:(0,s.jsx)(u.otZ,{})})})]})})}function f(e){let{className:t,canBack:l,children:i,isNew:d,...o}=e,{push:m,pathname:x}=(0,a.useRouter)(),u=(0,n.R)();return(0,s.jsxs)("div",{className:"relative flex flex-col flex-1 w-full h-full min-h-fit bg-gray-16",children:[(0,s.jsx)(p,{showQuery:!0,style:{top:"".concat(u,"px")},className:"!sticky px-[3.125rem] py-4 !max-w-none bg-green-2 mo:px-4 mo:h-[4.25rem]"}),(0,s.jsxs)("div",{className:c()("w-full h-full mx-auto px-[60px] flex flex-col flex-1",{" max-w-[90rem]":!d}),children:[l&&(0,s.jsxs)("div",{className:"flex items-center my-5 text-sm cursor-pointer",onClick:()=>m("/carbon/service"),children:[(0,s.jsx)(r.YFh,{className:"text-lg"}),"返回"]}),(0,s.jsx)("div",{className:c()("flex flex-col ",t),children:i})]})]})}},2545:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return F}});var s=l(1527),a=l(1600),n=l(959),r=l(1191),i=l(2702),d=l(4875),c=l.n(d),o=l(3378);function m(e){return(0,s.jsx)(o.Z,{opts:{locale:"en"},notMerge:!0,lazyUpdate:!0,...e})}var x=l(9346),u=l(7661),h=l(1875),p=l(1671),f=l(5591),j=l(6699),v=l(9701),N=l(8948),b=l(5858);function g(e){let[t,l]=(0,n.useState)(!0),{text:a,onChange:r}=e;return(0,n.useMemo)(()=>{r&&r(t)},[t]),(0,s.jsx)("div",{className:"inline-block font-bold",onClick:()=>l(!t),children:(0,s.jsxs)("div",{className:"flex items-center cursor-pointer",children:[(0,s.jsx)("span",{children:a}),(0,s.jsx)(i.Tgc,{height:"7px",className:c()("ml-1",!t&&"rotate-180")})]})})}function w(e){let[t,l]=(0,n.useState)(!0),{data:a}=e,r=[{label:"产品系统",text:a.productSystemName},{label:"分配方法",text:"As defined in processes"},{label:"目标数量",text:a.targetAmount},{label:"影响评价方法",text:a.methodName},{label:"影响类别",text:"IPCC 2021 GWP 100"}];return(0,s.jsxs)("div",{children:[(0,s.jsx)(g,{text:"一般信息",onChange:e=>l(e)}),t&&(0,s.jsx)("div",{className:"mt-4",children:r.map((e,t)=>(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsxs)("label",{className:"",children:[e.label," :"]}),(0,s.jsx)("span",{className:"ml-1 text-gray-6",children:e.text})]},"data-".concat(t)))})]})}function y(e){let[t,l]=(0,n.useState)(!0),{data:a}=e;return(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)(g,{text:"碳足迹结果",onChange:e=>l(e)}),t&&(0,s.jsx)("div",{className:"text-[1.75rem] font-semibold mt-4",children:a})]})}function I(e){let[t,l]=(0,n.useState)(!0),{data:a,referenceUnit:r}=e,i=[{title:"贡献",dataIndex:"contribution",width:"100px"},{title:"过程",dataIndex:"process",render:e=>(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(u.G3d,{className:"svg-purple"}),(0,s.jsx)("span",{className:"ml-1",children:e})]})},{title:"所需数量",dataIndex:"requiredAmount"},{title:"结果",dataIndex:"result",render:e=>(0,s.jsxs)("span",{children:[e,"m3"===r?(0,s.jsxs)("span",{children:["m",(0,s.jsx)("sup",{children:"3"})]}):r]})}],d=(0,n.useMemo)(()=>{var e;let t=(null===(e=a[0])||void 0===e?void 0:e.children)||[],l=["#EB505B","#4780C6","#FFCE5D","#3F9F4A","#7B41A0","#757475"],s=[],n=[],i=0;t.map((e,t)=>{if(t<5){let a=e.result+" "+r+": "+e.process;s.push(a);let i=[0];for(let l=0;l<=t;l++)l<t?i.push(0):i.push(e.result);n.push({name:a,color:l[t],type:"bar",barWidth:40,data:i,barGap:"-100%"})}else i+=e.result||0});let d=i+" "+r+": other";return s.push(d),n.push({name:d,color:"#757475",type:"bar",barWidth:40,barGap:"-100%",data:[0,0,0,0,0,0,i]}),{grid:{top:20,left:50,right:790,bottom:20},xAxis:{type:"category",axisLine:{show:!0,lineStyle:{color:"#999999"}},axisTick:{show:!1},axisLabel:{show:!1}},legend:{orient:"vertical",right:0,y:"center",data:s,itemHeight:6,itemWidth:40,itemGap:20,textStyle:{padding:6}},yAxis:{type:"value",axisLine:{show:!0,lineStyle:{color:"#999999"}},splitLine:{show:!1},axisTick:{show:!0,length:5}},series:n}},[a]);return(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)(g,{text:"贡献树",onChange:e=>l(e)}),t&&(0,s.jsxs)("div",{className:"",children:[(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(x.i,{size:"small",columns:i,data:a,cellClassName:(e,t,l)=>l%2==0?"bg-gray-16 ".concat(0===t&&"rounded-l-md"," ").concat(t===i.length-1&&"rounded-r-md"):"",headerClassName:{background:"#fff"}})}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("h4",{children:"对影响类别结果的前5个贡献 - 概述"}),(0,s.jsx)("div",{className:"w-full overflow-x-auto",children:(0,s.jsx)("div",{style:{minWidth:"1200px"},children:(0,s.jsx)(m,{style:{width:"100%"},option:d})})})]})]})]})}function k(e){let[t,l]=(0,n.useState)(!0),{data:a}=e,r=[{title:"名称",dataIndex:"name",render:e=>(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(p.J9I,{fill:"#29953A",className:"text-sm"}),(0,s.jsx)("span",{className:"ml-1",children:e})]}),width:"40%"},{title:"种类",dataIndex:"category",width:"30%"},{title:"数量",dataIndex:"amount",width:"20%"},{title:"单位",dataIndex:"unit",width:"10%"}];return(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)(g,{text:"清单列表",onChange:e=>l(e)}),t&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"mt-4 mb-3",children:"输入"}),(0,s.jsx)("ul",{className:"flex mb-1",children:r.map((e,t)=>(0,s.jsx)("li",{className:"px-3 text-sm font-bold",style:{width:e.width},children:e.title},"columns".concat(t)))}),(0,s.jsx)("div",{className:"max-h-[15rem] overflow-y-auto",children:(0,s.jsx)(x.i,{size:"small",hiddenHeader:!0,columns:r,data:a.inputData,cellClassName:(e,t,l)=>l%2==0?"bg-gray-16 ".concat(0===t&&"rounded-l"," ").concat(t===r.length-1&&"rounded-r"):"",headerClassName:{background:"#fff"},maxHeight:"300px"})}),(0,s.jsx)("h4",{className:"mt-4 mb-3",children:"输出"}),(0,s.jsxs)("div",{className:"max-h-[20rem] overflow-y-auto",children:[(0,s.jsx)("ul",{className:"flex mb-1",children:r.map((e,t)=>(0,s.jsx)("li",{className:"px-3 text-sm font-bold",style:{width:e.width},children:e.title},"columns".concat(t)))}),(0,s.jsx)("div",{className:"max-h-[15rem] overflow-y-auto",children:(0,s.jsx)(x.i,{size:"small",hiddenHeader:!0,columns:r,data:a.outputData,cellClassName:(e,t,l)=>l%2==0?"bg-gray-16 ".concat(0===t&&"rounded-l"," ").concat(t===r.length-1&&"rounded-r"):"",headerClassName:{background:"#fff"}})})]})]})]})})}function C(e){let[t,l]=(0,n.useState)(!0),{data:a}=e,r=[{title:"过程",dataIndex:"process",render:(e,t)=>(0,s.jsxs)("div",{className:"flex items-center",children:[t.children?(0,s.jsx)(f.$nz,{fill:"#9C27B0",className:"text-sm"}):(0,s.jsx)(u.G3d,{className:"svg-purple"}),(0,s.jsx)("span",{className:"ml-1",children:e})]}),width:"40%"},{title:"产品",dataIndex:"product",render:e=>e?(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(h.nbt,{stroke:"#0084FF",className:"text-sm svg-blue"}),(0,s.jsx)("span",{className:"ml-1",children:e})]}):"",width:"30%"},{title:"数量",dataIndex:"amount",width:"20%"},{title:"单位",dataIndex:"unit",width:"10%"}];return(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)(g,{text:"总需求",onChange:e=>l(e)}),t&&(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("ul",{className:"flex mb-1",children:r.map((e,t)=>(0,s.jsx)("li",{className:"px-3 text-sm font-bold",style:{width:e.width},children:e.title},"columns".concat(t)))}),(0,s.jsx)("div",{className:"max-h-[15rem] overflow-y-auto",children:(0,s.jsx)(x.i,{hiddenHeader:!0,size:"small",columns:r,data:a,cellClassName:(e,t,l)=>l%2==0?"bg-gray-16 ".concat(0===t&&"rounded-l"," ").concat(t===r.length-1&&"rounded-r"):"",headerClassName:{background:"#fff"}})})]})]})}var F=function(){let{query:e}=(0,N.useRouter)(),[t,l]=(0,n.useState)(!1),[i,d]=(0,n.useState)({}),[c,o]=(0,n.useState)(!0),m=async()=>{let t=await (0,j.fF)(e.id);t&&(d(t&&t),o(!1))};(0,n.useEffect)(()=>{m()},[e.id]);let x=(e,t)=>0===e||0===t?0:t<0&&e>0?-(e/t):e/t,{generalInfo:u,carbonResult:h,contributeTreeData:p,referenceUnit:f,listData:g,totalRequire:F}=(0,n.useMemo)(()=>{let e=[],t=[],l=[],a="",n="",r={inputData:[],outputData:[]};if(i&&i.lcaResult){var d,c,o,m,u,h,p,f,j,N;let b=(0,v.tV)(JSON.parse(i.lcaResult));t={productSystemName:null===(d=b.extra)||void 0===d?void 0:d.productSystemName,methodName:null===(c=b.extra)||void 0===c?void 0:c.methodName,targetAmount:null===(o=b.extra)||void 0===o?void 0:o.targetAmount},a=b.totalImpacts[0].impact.referenceUnit||"";let g=null===(m=b.treeNode)||void 0===m?void 0:m.result;e=[{contribution:(100*x(g,g)).toFixed(2)+"%",process:null===(u=b.treeNode)||void 0===u?void 0:u.provider.name,requiredAmount:(null===(h=b.treeNode)||void 0===h?void 0:h.requiredAmount)+" "+(null===(p=b.treeNode)||void 0===p?void 0:p.refUnit),result:null===(f=b.treeNode)||void 0===f?void 0:f.result}],n=(0,s.jsxs)("span",{children:[g||0,"m3"===a?(0,s.jsxs)("span",{children:["m",(0,s.jsx)("sup",{children:"3"})]}):a]});let w=e=>{e&&e.map(e=>{e.contribution=(100*x(e.result,g)).toFixed(2)+"%",e.process=e.provider.name,e.requiredAmount=e.requiredAmount+" "+e.refUnit,e.children&&e.children.length>0&&w(e.children)})};w(null===(j=b.treeNode)||void 0===j?void 0:j.children.sort((e,t)=>t.result-e.result)),e[0].children=null===(N=b.treeNode)||void 0===N?void 0:N.children,b.totalFlows.map(e=>{let t={name:e.flow.name,category:e.flowPropertyPath,amount:e.value,unit:e.refUnit};e.isInput?r.inputData.push(t):r.outputData.push(t)}),b.totalRequirements.map(e=>{l.push({process:e.provider.name,product:e.flow.name,amount:e.value,unit:e.refUnit})})}return{generalInfo:t,carbonResult:n,contributeTreeData:e,referenceUnit:a,listData:r,totalRequire:l}},[i]),S=async()=>{if(!e.id)return!1;l(!0);let t=await (0,j.LW)(e.id);l(!1);let s=new Blob([t.data]),a="".concat(u.productSystemName,".xlsx"),n=document.createElement("a");n.download=a,n.style.display="none",n.href=URL.createObjectURL(s),document.body.appendChild(n),n.click(),URL.revokeObjectURL(n.href),document.body.removeChild(n)};return(0,s.jsx)(a.m,{className:"text-lg text-black",children:c?(0,s.jsx)("div",{className:"h-[100vh] w-full items-center",children:(0,s.jsx)(b.g,{})}):(0,s.jsxs)("div",{className:"mo:break-all",children:[(0,s.jsx)("h3",{className:"my-5 text-2xl font-semibold",children:"碳足迹结果"}),(0,s.jsxs)("div",{className:"p-5 bg-white rounded-2xl",children:[(0,s.jsx)(w,{data:u}),(0,s.jsx)(y,{data:h}),(0,s.jsx)(I,{data:p,referenceUnit:f}),(0,s.jsx)(k,{data:g}),(0,s.jsx)(C,{data:F})]}),(0,s.jsx)("div",{className:"flex justify-center w-full mt-5 mb-10",children:(0,s.jsx)(r.z,{onClick:()=>!t&&S(),className:"mt-5 text-lg bg-green-2 w-[26.875rem] text-white rounded-lg  h-14 flex items-center justify-center",children:t?(0,s.jsx)("div",{children:(0,s.jsx)(b.g,{size:"2rem",color:"#fff"})}):(0,s.jsx)("span",{children:"导出Excel"})})})]})})}}},function(e){e.O(0,[713,769,7307,6574,6740,4798,1420,4392,2351,9774,2888,179],function(){return e(e.s=7959)}),_N_E=e.O()}]);